<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USB Code Reader fastmedicsCorporation</title>
    <style>
        /* Global Styles */
        body {
            font-family: 'Roboto', sans-serif;
            background: #2d2d2d; /* Dark background */
            color: #fff; /* Light text for contrast */
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            position: relative;
            text-align: center;
        }

        h1, h2 {
            color: #ff5733; /* Bold red-orange for a strong accent */
            text-align: center;
            font-size: 36px;
            margin: 20px;
            text-transform: uppercase;
            letter-spacing: 3px;
            font-weight: bold;
        }

        p {
            color: #b0b0b0; /* Lighter gray for descriptions */
            font-size: 18px;
            margin-bottom: 30px;
        }

        /* Styling for buttons */
        button {
            padding: 15px 25px;
            background: #333; /* Dark background for buttons */
            color: #ff5733; /* Bright accent color for text */
            font-size: 18px;
            font-weight: bold;
            border: 2px solid #ff5733; /* Border to match accent */
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }

        button:hover {
            background: #ff5733; /* Change background color on hover */
            color: #333; /* Invert text color on hover */
            transform: translateY(-3px);
        }

        button:active {
            background: #cc4625; /* Slightly darker shade when clicked */
            transform: translateY(3px);
        }

        /* Styling for the code input and output areas */
        textarea, pre {
            width: 80%;
            max-width: 1000px;
            height: 300px;
            background-color: #1f1f1f; /* Slightly darker than the body */
            color: #00ff00; /* Neon green for code */
            border: 2px solid #ff5733; /* Bold red border */
            border-radius: 10px;
            font-size: 16px;
            padding: 15px;
            margin-top: 20px;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-y: auto;
            box-sizing: border-box;
        }

        /* Status text */
        #status {
            font-size: 20px;
            color: #00bcd4; /* Light blue-green for status */
            margin-top: 30px;
        }

        /* Add subtle shadow to all elements */
        h1, h2, p, textarea, pre, button {
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
        }

        /* Responsive layout for mobile devices */
        @media (max-width: 768px) {
            h1 {
                font-size: 28px;
            }

            h2 {
                font-size: 24px;
            }

            textarea, pre {
                width: 90%;
            }

            button {
                width: 90%;
            }
        }
    </style>
</head>
<body>

    <h1>USB Code Reader fastmedicsCorporation</h1>

    <!-- Code input area -->
    <h2>Enter Your Code:</h2>
    <textarea id="codeInput" placeholder="Paste or write your code here..."></textarea>

    <!-- Buttons for formatting and copying -->
    <button onclick="formatCode()">Format Code</button>
    <button onclick="copyToClipboard()">Copy Code</button>

    <!-- Code display area -->
    <h2>Formatted Code:</h2>
    <pre><code id="codeDisplay">The formatted code will appear here...</code></pre>

    <h2>Status</h2>
    <p id="status">Waiting for USB connection...</p>

    <script>
        // Simple language detection based on keywords
        const detectLanguage = (code) => {
            if (code.includes('#include <Arduino.h>') || code.includes('void setup()') || code.includes('void loop()')) {
                return 'Arduino';  // Arduino code detection
            }
            if (code.includes('#include')) return 'C++';
            if (code.includes('import')) return 'Python';
            if (code.includes('function')) return 'JavaScript';
            if (code.includes('class')) return 'Java';
            if (code.includes('print')) return 'Python';
            return 'Unknown';  // If no specific language is detected
        }

        // Function to process and format code
        function formatCode() {
            const codeInputElement = document.getElementById('codeInput');
            let code = codeInputElement.value;

            // Detect language
            const language = detectLanguage(code);
            document.getElementById('status').innerText = `Detected Language: ${language}`;

            // Format code based on detected language
            if (language === 'C++') {
                // C++ simple formatting (you can replace it with clang-format in a real app)
                code = code.replace(/\s+/g, ' ').trim();
            } else if (language === 'Python') {
                // Python simple formatting (replace it with Black or autopep8 in a real app)
                code = code.replace(/\s+/g, ' ').trim();
            } else if (language === 'JavaScript') {
                // JavaScript simple formatting (replace it with Prettier in a real app)
                code = code.replace(/\s+/g, ' ').trim();
            } else if (language === 'Arduino') {
                // Arduino simple formatting (you can improve this as needed)
                code = code.replace(/\s+/g, ' ').trim();
            } else {
                // If language is unknown, just return the code as it is
                code = code.trim();
            }

            // Display the formatted code
            document.getElementById('codeDisplay').innerText = code;
        }

        function copyToClipboard() {
            var codeElement = document.getElementById("codeDisplay");
            var range = document.createRange();
            range.selectNode(codeElement);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            document.execCommand("copy");

            alert("Code copied to clipboard!");
        }

        // Function to connect to the USB and read code
        async function connectUSB() {
            try {
                // Request the user to select a USB device
                const device = await navigator.usb.requestDevice({
                    filters: [{ vendorId: 0x2341 }]  // Adjust vendorId for your device
                });

                // Once the device is connected, open and claim the interface
                await device.open();
                await device.selectConfiguration(1);
                await device.claimInterface(0);

                // Update status
                document.getElementById('status').innerText = 'Device connected! Reading data...';

                // Read data from the USB device (e.g., C++ code or any string)
                const result = await device.transferIn(5, 64);  // Read 64 bytes of data from endpoint 5
                const decoder = new TextDecoder();
                const code = decoder.decode(result.data);

                // Detect language
                const language = detectLanguage(code);
                document.getElementById('status').innerText = `Detected Language: ${language}`;

                // Display the code in the textarea and code block
                document.getElementById('codeInput').value = code;
                document.getElementById('codeDisplay').innerText = code;

                // Optionally auto-format the code based on language
                formatCode();
            } catch (err) {
                console.error('Error connecting to USB device:', err);
                document.getElementById('status').innerText = 'Failed to connect to USB device.';
            }
        }

        // Constantly check for USB connection
        async function waitForUSBConnection() {
            while (true) {
                // Continuously try to connect to the USB device
                await connectUSB();
                // Wait for 3 seconds before checking again (you can adjust this duration)
                await new Promise(resolve => setTimeout(resolve, 3000));
            }
        }

        // Start waiting for USB connection on page load
        window.addEventListener('load', waitForUSBConnection);

    </script>

</body>
</html>
